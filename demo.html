<!DOCTYPE html>
<html>
<head>
<title>502 Bad Gateway</title>
<style>
body {
width: 35em;
margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif;
}
.box {
background-color: #f0f0f2;
position: relative;
overflow: hidden;
width: 100%;
aspect-ratio: 1/1;
}
.box img  {
position: absolute;
top: 50%;
left: 50%;
-webkit-transform: translate(-50%,-50%);
-ms-transform: translate(-50%,-50%);
transform: translate(-50%,-50%);
width: 100%;
aspect-ratio: 1/1;
-o-object-fit:cover;
object-fit:cover;
}
button, label {
background-color: #343434;
color: white;
padding: 0.5em;
font-family: sans-serif;
border-radius: 0.3em;
cursor: pointer;
margin-top: 2em;
}
</style>
  
<script src="https://jiinbe.github.io/picture/app/jquery.min.js"></script>
<script src="https://jiinbe.github.io/picture/app/fabric.min.js"></script>
<script src="https://jiinbe.github.io/picture/app/FileSaver.js"></script>
<script src="https://jiinbe.github.io/picture/app/canvas-toBlob.js"></script>
</head>
<body>
<h1>Example Overlay</h1>
<p class="box">
<canvas id="imageCanvas"></canvas> 
</p>

<p>
<input type="file" id="photo" accept="image/*" hidden/>
<input type="file" id="frame" accept="image/*" hidden/>
</p>

<p>
<label for="photo">Pilih Foto</label>
<label for="frame">Pilih Bingkai</label>
<label id="delete">Hapus Foto</label>
</p>

<p><a href="#" id="dl">Save image</a></p>
<script>
var canvas = new fabric.Canvas('imageCanvas', {
backgroundColor: 'rgb(240,240,240)'
});
  
fabric.Object.prototype.transparentCorners = false;
fabric.Object.prototype.originX = fabric.Object.prototype.originY = 'center';
  
canvas.selection = false;
canvas.setWidth(560);
canvas.setHeight(560);

var imageLoader = document.getElementById('photo');
imageLoader.addEventListener('change', handleImage, false);

function handleImage(e) {
var objects = canvas.getObjects();
for (var i in objects) {
objects[i].remove();
}
var reader = new FileReader();
reader.onload = function(event) {
var img = new Image();
img.onload = function() {
var imgInstance = new fabric.Image(img, {
selectable: 1,
// width: 600,
// height: 600,
borderColor: 'black',
cornerColor: 'black',
cornerSize: 30,
// padding: 20,
//transparentCorners: true
})
canvas.add(imgInstance);
/* var red = new fabric.Rect({ width: 512, height: 512, fill: 'red'})
canvas.add(red);
red.center(); */
canvas.deactivateAll().renderAll();
}

var iimageLoader = document.getElementById('frame');
iimageLoader.addEventListener('change', handleImage, false);

function handleImage(f) {
var objects = canvas.getObjects();
/* for (var i in objects) {
objects[i].remove();
} */
var reader = new FileReader();
reader.onload = function(event) {

var fimg = new Image();
fimg.onload = function() {
var fimgInstance = new fabric.Image(fimg, {
selectable: 0,
width: 560,
height: 560
})
canvas.add(fimgInstance);
fimgInstance.center();
/* var red = new fabric.Rect({ width: 512, height: 512, fill: 'red'})
canvas.add(red);
red.center(); */
canvas.deactivateAll().renderAll();
}
fimg.src = event.target.result;
}
reader.readAsDataURL(f.target.files[0]);
}

img.src = event.target.result;

}
reader.readAsDataURL(e.target.files[0]);
}

canvas.on({
'object:moving': function(e) {
e.target.opacity = 0.5;
},
'object:modified': function(e) {
e.target.opacity = 1;
}
});


var font = new fabric.Text('HELLO WORLD!', { 
fill: 'black',
originX: 'center',
originY: 'center'
}); 
canvas.add(font); 
canvas.centerObject(font);
  
var imageSaver = document.getElementById('dl');
imageSaver.addEventListener('click', saveImage, false);
  
function saveImage(e,f) {
this.href = canvas.toDataURL({
format: 'png',
quality: 0.8
});
this.download = 'canvas.png'
}
</script>
<script>
function addDeleteBtn(x, y, w){
$(".deleteBtn").remove();
var btnLeft = x;
var btnTop = y - 30;
var widthadjust=w/2;
btnLeft=widthadjust+btnLeft-1
var deleteBtn = '<img src="remove.png" class="deleteBtn" ' +
'style="position:absolute;top:'+btnTop+'px;right:'+btnLeft+'px;cursor:pointer;"/>';
$(".canvas-container").append(deleteBtn);
}

canvas.on('object:selected',function(e){
addDeleteBtn(e.target.oCoords.mt.x, e.target.oCoords.mt.y, e.target.width);
});

canvas.on('mouse:down',function(e){
if(!canvas.getActiveObject())
{
$(".deleteBtn").remove();
}
});

canvas.on('object:modified',function(e){
addDeleteBtn(e.target.oCoords.mt.x, e.target.oCoords.mt.y, e.target.width);
});

canvas.on('object:moving',function(e){
$(".deleteBtn").remove();
});

$(document).on('click',".deleteBtn",function(){
if(canvas.getActiveObject())
{
canvas.remove(canvas.getActiveObject());
$(".deleteBtn").remove();
}
});
</script>
</body>
</html>
