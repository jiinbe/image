<!doctype html>
<html>
<head>
<title>Example Domain</title>

<meta charset="utf-8" />
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
<style type="text/css">
body {
background: linear-gradient(to left, #f1f1f1 70px, #fff 70px);
}
p, span {
font-family: Arial;
font-size: 11pt;
padding: 8px 0;
margin: 0;
}
p.heading, span.heading {
font-weight: bold;
}
p.heading.primary, span.heading.primary {
color: #c7531e;
}
span {
display: inline-block;
}
#canvas-wrapper {
position: absolute;
top: 0;
left: 0;
}
#output-area {
user-select: none;
}
#output-area.output-mode p {
margin: 0;
padding: 0;
background-color: white;
}
i {
font-family: Arial;
font-size: 11pt;
padding: 8px 0;
margin: 0;
}
.mod {
color: rgba(0, 0, 0, 0.7);
background: #d4d4d4;
margin: 0 2px;
padding: 0 8px;
border-radius: 2px;
}
.mod.active {
color: black;
background: #46b9da;
}
.mod.active.abnormal {
color: #c00000;
}
.mod.template {
padding: 4px 8px;
}
.mod.bold {
font-weight: bold;
}
.mod.output {
margin: 0 !important;
padding: 0 !important;
background: none !important;
}
#action-bar {
display: flex;
flex-direction: column;
justify-content: space-around;
height: 200px;
position: sticky;
width: 50px;
height: 300px;
bottom: 30%;
left: 100%;
}
#action-bar button {
font-size: 20px;
}
.hidden {
display: none;
}
table {
font-family: Arial;
font-size: 11pt;
margin: 0;
border-collapse: collapse;
}
td {
padding: 2px;
border: 1px solid black;
}
td:nth-child(1) {
font-weight: bold;
text-align: left;
}
.box {
background-color: #f0f0f2;
position: relative;
overflow: hidden;
width: 100%;
aspect-ratio: 1/1;
}
.box img  {
position: absolute;
top: 50%;
left: 50%;
-webkit-transform: translate(-50%,-50%);
-ms-transform: translate(-50%,-50%);
transform: translate(-50%,-50%);
width: 100%;
aspect-ratio: 1/1;
-o-object-fit:cover;
object-fit:cover;
}
</style>    

<script src="app/jquery.min.js"></script>
<script src="app/fabric.min.js"></script>
<script src="app/FileSaver.js"></script>
<script src="app/canvas-toBlob.js"></script>
</head>

<body>
<!-- NOTE: ADDED META FOR SCALE -->
<div id="canvas-wrapper">
<div class="box">
<canvas id="imageCanvas"></canvas> 
</div>
</div>

<div id="action-bar" contenteditable="false">
<!-- Prevent accidental button editing -->
<button onclick="clearCanvas()"><i class="bi bi-eraser"></i></button>
<!--<button onclick="postProcessSelection()"><i class="bi bi-magic"></i></button>-->
<button onclick="indent()"><i class="bi bi-text-indent-left"></i></button>
<!--<button onclick=""><i class="bi bi-indent"></i></button>-->
<!--
<button onclick="selectAll()"><i class="bi bi-textarea-t"></i></button>
<button onclick="copyHTML()"><i class="bi bi-clipboard2-plus"></i></button>
-->
<button onclick="downloadHTML()"><i class="bi bi-download"></i></button>
<!--
<button onclick="copyNoGapText()"><i class="bi bi-input-cursor-text"></i></button>
<button onclick="insertTemplate()"><i class="bi bi-plus-circle"></i></button>
-->
<button onclick="refresh()"><i class="bi bi-arrow-clockwise"></i></button>
<!--<button onclick="toggleOutputMode()"><i class="bi bi-arrow-left-right"></i></button>-->
</div>

<script>
var canvas = new fabric.Canvas('imageCanvas', {
backgroundColor: 'rgb(255, 255, 255)'
});
  
fabric.Object.prototype.transparentCorners = false;
fabric.Object.prototype.originX = fabric.Object.prototype.originY = 'center';
  
canvas.selection = false;
canvas.setWidth(600);
canvas.setHeight(600);

var imageLoader = document.getElementById('photo');
imageLoader.addEventListener('change', handleImage, false);

function handleImage(e) {
var objects = canvas.getObjects();
for (var i in objects) {
objects[i].remove();
}
var reader = new FileReader();
reader.onload = function(event) {
var img = new Image();
img.onload = function() {
var imgInstance = new fabric.Image(img, {
selectable: 1,
borderColor: 'black',
cornerColor: 'black',
cornerSize: 30
})
canvas.add(imgInstance);
/* var red = new fabric.Rect({ width: 600, height: 600, fill: 'red'})
canvas.add(red);
red.center(); */
canvas.deactivateAll().renderAll();
}

var iimageLoader = document.getElementById('frame');
iimageLoader.addEventListener('change', handleImage, false);

function handleImage(f) {
var objects = canvas.getObjects();
/* for (var i in objects) {
objects[i].remove();
} */
var reader = new FileReader();
reader.onload = function(event) {

var fimg = new Image();
fimg.onload = function() {
var fimgInstance = new fabric.Image(fimg, {
selectable: 0,
width: 600,
height: 600
})
canvas.add(fimgInstance);
fimgInstance.center();
/* var red = new fabric.Rect({ width: 600, height: 600, fill: 'red'})
canvas.add(red);
red.center(); */
canvas.deactivateAll().renderAll();
}
fimg.src = event.target.result;
}
reader.readAsDataURL(f.target.files[0]);
}

img.src = event.target.result;

}
reader.readAsDataURL(e.target.files[0]);
}

canvas.on({
'object:moving': function(e) {
e.target.opacity = 0.5;
},
'object:modified': function(e) {
e.target.opacity = 1;
}
});


var font = new fabric.Text('HELLO WORLD!', { 
fill: 'black',
originX: 'center',
originY: 'center'
}); 
canvas.add(font); 
canvas.centerObject(font);
  
$("#dl").click(function(){
$("#imageCanvas").get(0).toBlob(function(blob){
saveAs(blob, "image.png");
});
});

function checkInput() {
var input = document.getElementById('photo').value;
var input2 = document.getElementById('frame').value;
var button = document.getElementById('dl');
var button2 = document.getElementById('shared');
button.disabled = input === '';
button2.disabled = input2 === '';
}
</script>
<script>
document.getElementById("shared").addEventListener("click", () => {
alert("share image");
const dataUrl = canvas.toDataURL(); 
fetch(dataUrl)
.then(res => res.blob())
.then(blob => {
//console.log(blob)
const filesArray = [new File([blob], 'image.png', { type: blob.type, lastModified: new Date().getTime() })];
console.log(filesArray);
const shareData = {
title: "FREE AND SIMPLE PFP GENERATOR",
text: "FREE AND SIMPLE PFP GENERATOR",
url: "https://jiinbe.github.io/fabricjs2/",
files: filesArray
};
console.log(shareData);
if (navigator.share) {
navigator.share(
shareData
)
.then(() => alert("thanks for share")) 
.catch(error => alert("error", error)); 
} else {
alert('navigator.share not available'); 
}
})
});
</script>
</body>
</html>
